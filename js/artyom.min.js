/**
 * Artyom uses webkitSpeechRecognition && SpeechSynthesisUtterance property of Google Inc.
 * Requires browser with WebKit -  This object is only supported by Google Chrome and Apple Safari.
 * 
 * @version 0.5.1
 * @dependencies [artyomCommands.js]
 * @copyright 2015, Deutschland.
 * @author Carlos Delgado | 2015
 * @param {type} window
 * @Description Artyom JS Core - See Documentation for further information
 * @see http://sdkcarlos.github.io/artyom.html
 * @returns {object}
 */
!function(e){"use strict";function o(){if("object"!=typeof artyCommands)console.warn("Hey .. pss ! You have not loaded the artyom commands file. I can't do anything without it, only (artyom.test()), otherwise the execution of the things could get very very bad.");else var o=artyCommands.getCommands("en-GB");var m={};m.device=g,m.getVoices=function(){return e.speechSynthesis.getVoices()},m.getAvailableCommands=function(){var e=[];o||console.warn("Cannot list commands. No command has been added");for(var n=0;n<o.length;n++){var t=o[n],r={};r.indexes=t.indexes,t.smart&&(r.smart=!0),t.description&&(r.description=t.description),e.push(r)}return e},m.initialize=function(n){if("object"!=typeof n)return void console.error("You must give the configuration for start artyom properly.");if("speechSynthesis"in e){if(n.lang){switch(n.lang){case"de":case"de-DE":u=r;break;case"en-GB":u=d;break;case"es":case"es-CO":case"es-ES":u=i;break;case"en":case"en-US":u=l;break;case"fr":case"fr-FR":u=a;break;case"it":case"it-IT":u=s;break;case"jp":case"ja-JP":u=c;break;default:console.info("The given language for artyom is not supported yet. English has been set to default")}t.lang=n.lang}return t.continuous=n.continuous,m.is.number(n.speed)&&(t.speed=n.speed),m.is.number(n.volume)&&(t.volume=n.volume),t.listen=n.listen,t.debug=n.debug,n.mode&&(t.mode=n.mode),"undefined"!=typeof artyCommands&&(o=artyCommands.getCommands(n.lang)),t.listen===!0&&f(),!0}return m.triggerEvent("error",{code:"artyom_unsupported",message:"Artyom is not supported in this browser. Please consider in update for a WebKit browser like Google Chrome"}),console.error("Artyom is not supported in this browser. Please consider in update for a WebKit browser like Google Chrome"),!1},m.fatality=function(){return t.continuous=!1,n.stop(),!0},m.shutUp=function(){do e.speechSynthesis.cancel();while(e.speechSynthesis.pending===!0)},m.getProperties=function(){return t},m.triggerEvent=function(e,o){var n=new CustomEvent(e,{detail:o});return document.dispatchEvent(n),n},m.when=function(e,o){document.addEventListener(e,function(e){o(e.detail)},!1)},m.getLanguage=function(e){if(e)switch(u){case"Google UK English Male":return"en-GB";case"Google Español":return"es";case"Google Deutsch":return"de";case"Google Français":return"fr";case"Google Italiano":return"it";case"Google 日本人":return"jp";case"Google US English":return"en-US"}switch(u){case"Google UK English Male":return"en-GB";case"Google Español":return"es-CO";case"Google Deutsch":return"de-DE";case"Google Français":return"fr-FR";case"Google Italiano":return"it-IT";case"Google 日本人":return"ja-JP";case"Google US English":return"en-US"}},m.say=g.isMobile?function(o,n){if(m.speechSupported()){var r=new SpeechSynthesisUtterance;r.text=o,r.volume=t.volume,r.lang=t.lang,r.addEventListener("end",function(){"function"==typeof n&&n()}),e.speechSynthesis.speak(r)}}:function(o,n){if(m.speechSupported()){var r=function(o,r,i){var a=new SpeechSynthesisUtterance;a.text=o,a.volume=t.volume,a.rate=t.speed,u&&(a.voice=speechSynthesis.getVoices().filter(function(e){return e.name==u})[0]),n&&("function"==typeof n.onEnd&&a.addEventListener("end",function(){r>=i&&n.onEnd()}),"function"==typeof n.onStart&&a.addEventListener("start",function(){1==r&&n.onStart()})),m.debug(r+" text chunks processed succesfully out of "+i),e.speechSynthesis.speak(a)};if("undefined"!=typeof o.length)if(o.length>0){var i,a=o.split(","),s=o.split(".");i=a.length>s.length?a.filter(function(e){return e}):s.filter(function(e){return e}),i.forEach(function(e,o){var n=o+1;e&&r(e,n,i.length)}),m.triggerEvent("saySomething")}else m.debug("Artyom expects a string to say ... none given.","warn");else m.debug("Artyom expects a string to say ... "+typeof o+" given.","warn")}},m.test=function(){"webkitSpeechRecognition"in e?(alert("I can hear you ! Initialize me now."),m.initialize({lang:"en-GB",listen:!1})):alert("Artyom can't listen to you in this browser. Speech Recognition is not supported in this browser."),"speechSynthesis"in e?m.say("1,2,3,4,5,6,7,8,9,10. Well, all is in order here.",{onEnd:function(){alert("The test of speech is over.")}}):alert("Artyom can't say nothing in this browser. Speech Synthesis is not supported in this browser.")},m.speechSupported=function(){return"speechSynthesis"in e},m.recognizingSupported=function(){return"webkitSpeechRecognition"in e};var f=function(){var e,o;if(n.continuous=!0,n.interimResults=!0,n.lang=t.lang,n.onstart=function(){m.debug("Event reached : onStart"),t.recognizing=!0,o=!0},n.onerror=function(n){"network"==n.error&&m.triggerEvent("error",{code:"network",message:"Artyom needs internet to work properly"}),"no-speech"==n.error&&t.continuous===!1&&m.triggerEvent("info",{code:"info_no_speech",message:"Artyom didn't hear anything. It will take a break."}),"audio-capture"==n.error&&(o=!1,m.triggerEvent("error",{code:"audio-capture",message:"There's not any audiocapture device installed on this computer."})),"not-allowed"==n.error&&(o=!1,n.timeStamp-e<100?m.triggerEvent("error",{code:"info_blocked",message:"Artyom needs the permision of the microphone, is blocked."}):m.triggerEvent("error",{code:"info_denied",message:"Artyom needs the permision of the microphone, is denied"}))},n.onend=function(){m.triggerEvent("FinishRecognition",{code:"artyom_dont_listen",message:"Artyom stop listening."}),t.continuous===!0&&(o===!0?(n.start(),m.debug("Artyom initialization finished. Restarting","info")):console.error("Verify the microphone and check for the table of errors in sdkcarlos.github.io/sites/artyom.html to solve your problem. If you want to give your user a message when an error appears add an artyom listener")),t.recognizing=!1},n.onresult=function(e){var o=e.results.length;if(m.triggerEvent("Recognition",{code:"artyom_listen",message:"Artyom is listening to you."}),"normal"==t.mode)for(var r=e.resultIndex;o>r;++r){var i=e.results[r][0].transcript;if(e.results[r].isFinal){var a=m.execute(i.trim());if(a!==!1&&1==t.recognizing){m.debug("<< Executing Matching Recognition in normal mode>>"),n.stop(),t.recognizing=!1,a.wildcard?a.objeto.action(a.indice,a.wildcard.item,a.wildcard.full):a.objeto.action(a.indice);break}}else m.debug("Normal mode : "+i)}else if("quick"==t.mode)for(var r=e.resultIndex;o>r;++r){var i=e.results[r][0].transcript;if(e.results[r].isFinal){var a=m.execute(i.trim());if(a!==!1&&1==t.recognizing){m.debug("<< Executing Matching Recognition in quick mode>>"),n.stop(),t.recognizing=!1,a.wildcard?a.objeto.action(a.indice,a.wildcard.item):a.objeto.action(a.indice);break}}else{var a=m.execute(i.trim());if(a!==!1&&1==t.recognizing){m.debug("<< Executing Matching Recognition in quick mode>>"),n.stop(),t.recognizing=!1,a.wildcard?a.objeto.action(a.indice,a.wildcard.item):a.objeto.action(a.indice);break}}m.debug("Quick mode : "+i)}},t.recognizing)n.stop(),m.debug("Voice recognition stopped");else try{n.start()}catch(r){console.warn("Fatal Error There's already a instance of me running in the background . It's recommendable to restart Google Chrome to fix this issue.")}};return m.doInstruction=function(e){if(!e||"string"!=typeof e)return console.warn("Cannot execute a non string command"),!1;var o=m.execute(e);return"object"!=typeof o?(console.warn("No command founded trying with "+e),!1):o.objeto?(o.objeto.smart?o.objeto.action(o.indice,o.wildcard.item,o.wildcard.full):o.objeto.action(o.indice),!0):void 0},m.execute=function(e){if(!e)return console.error("Internal error: Execution of empty command"),!1;m.debug(">> "+e);for(var n=0;n<o.length;n++){for(var t=o[n],r=t.indexes,i=-1,a=0;a<r.length;a++){var s=r[a];if(t.smart){if(-1!=s.indexOf("*")){var c=s.split("*");if(c.length>2){console.warn("Artyom found a smart command with "+(c.length-1)+" wildcards. Artyom only support 1 wildcard for each command. Sorry");continue}var l=c[0],d=c[1];if(""==d||" "==d){if(-1!=e.indexOf(l)||-1!=e.toLowerCase().indexOf(l.toLowerCase())){var u=e.replace(l,"");u=u.toLowerCase().replace(l.toLowerCase(),""),i=parseInt(a)}}else if(!(-1==e.indexOf(l)&&-1==e.toLowerCase().indexOf(l.toLowerCase())||-1==e.indexOf(d)&&-1==e.toLowerCase().indexOf(d.toLowerCase()))){var u=e.replace(l,"").replace(d,"");u=u.toLowerCase().replace(l.toLowerCase(),"").replace(d.toLowerCase(),""),u=u.toLowerCase().replace(d.toLowerCase(),""),i=parseInt(a)}}else console.warn("Founded command marked as SMART but have no wildcard in the indexes, remove the SMART for prevent extensive memory consuming or add the wildcard *");if(i>=0){i=parseInt(a);break}}}if(i>=0)return{indice:i,objeto:t,wildcard:{item:u,full:e}}}for(var n=0;n<o.length;n++){for(var t=o[n],r=t.indexes,i=-1,a=0;a<r.length;a++){var s=r[a];if(!t.smart){if(e===s){m.debug(">> MATCHED FULL EXACT OPTION "+s+" AGAINST "+e+" WITH INDEX "+a+" IN COMMAND ","info"),i=parseInt(a);break}if(e.toLowerCase()===s.toLowerCase()){m.debug(">> MATCHED OPTION CHANGING ALL TO LOWERCASE "+s+" AGAINST "+e+" WITH INDEX "+a+" IN COMMAND ","info"),i=parseInt(a);break}}}if(i>=0)return{indice:i,objeto:t}}for(var n=0;n<o.length;n++){for(var t=o[n],r=t.indexes,i=-1,a=0;a<r.length;a++)if(!t.smart){var s=r[a];if(e.indexOf(s)>=0){m.debug(">> MATCHED INDEX EXACT OPTION "+s+" AGAINST "+e+" WITH INDEX "+a+" IN COMMAND ","info"),i=parseInt(a);break}if(e.toLowerCase().indexOf(s.toLowerCase())>=0){m.debug(">> MATCHED INDEX OPTION CHANGING ALL TO LOWERCASE "+s+" AGAINST "+e+" WITH INDEX "+a+" IN COMMAND ","info"),i=parseInt(a);break}}if(i>=0)return{indice:i,objeto:t}}return!1},m.debug=function(e,o){if(t.debug===!0)switch(o){case"error":console.error(e);break;case"warn":console.warn(e);case"info":console.info(e);break;default:console.log(e)}},m.is={integer:function(e){return Number(e)===e&&0===e%1},"float":function(e){return e===Number(e)&&0!==e%1},"function":function(e){return"function"==typeof e?!0:!1},object:function(e){return"object"==typeof e?!0:!1},"boolean":function(e){return"boolean"==typeof e?!0:!1},array:function(e){return e.constructor===Array?!0:!1},number:function(e){return e===parseFloat(e)},odd:function(e){return m.is.number(e)&&1===Math.abs(e)%2},even:function(e){return m.is.number(e)&&0===e%2},jQueryObject:function(e){return e instanceof jQuery?!0:!1}},m.detectErrors=function(o){return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,"file://"==e.location.origin?(console.error("Fatal Error Detected : It seems you're running the artyom demo from a local file ! The SpeechRecognitionAPI Needs to be hosted someway (server as http or https). Artyom will NOT work here, Sorry."),{code:"artyom_error_localfile",message:"Fatal Error Detected : It seems you're running the artyom demo from a local file ! The SpeechRecognitionAPI Needs to be hosted someway (server as http or https). Artyom will NOT work here, Sorry."}):m.device.isChrome?("https:"!=e.location.protocol&&console.warn("Artyom is not running in HTTPS protocol,running in protocol : "+e.location.protocol+" that means the browser will ask the permission of microphone too often. You need a HTTPS Connection if you want artyom in continuous mode !"),navigator.getUserMedia?(navigator.getUserMedia({audio:!0},function(e){"function"==typeof o&&o(e)},function(e){"function"==typeof o&&o(e)}),{}):(console.log("Artyom couldn't found more errors in this browser."),!1)):(console.error("Fatal Error Detected: You are not running Google Chrome ! SpeechRecognitionAPI and SpeechSynthesisAPI is only available in google chrome ! "),{code:"artyom_error_browser_unsupported",message:"Fatal Error Detected: You are not running Google Chrome ! SpeechRecognitionAPI and SpeechSynthesisAPI is only available in google chrome ! "})},m.sayRandom=function(e){if(e instanceof Array){var o=Math.floor(Math.random()*e.length);return m.say(e[o]),{text:e[o],index:o}}return console.error("Random quotes must be in an array !"),null},m.getVersion=function(){return"0.5.1"},m}if("speechSynthesis"in e&&speechSynthesis.getVoices(),"webkitSpeechRecognition"in e)var n=new webkitSpeechRecognition,t={lang:"en-GB",recognizing:!1,continuous:!1,speed:1,volume:1,listen:!0,mode:"normal",debug:!1};var r="Google Deutsch",i="Google Español",a="Google Français",s="Google Italiano",c="Google 日本人",l="Google US English",d="Google UK English Male",u="Google UK English Male",g={isMobile:!1,isChrome:!0};(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(g.isMobile=!0),-1==navigator.userAgent.indexOf("Chrome")&&(g.isChrome=!1),"undefined"==typeof artyom&&(e.artyom=o())}(window);